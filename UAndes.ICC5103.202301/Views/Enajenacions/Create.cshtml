@using UAndes.ICC5103._202301.Models
@model UAndes.ICC5103._202301.Models.Enajenacion

@{
    ViewBag.Title = "Create";
}

<h2>NUEVA DECLARACION SOBRE ENAJENACION E INSCRIPCION DE BIENES RAICES (F2890)</h2>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
<div class="form-horizontal">
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

    <div class="form-group">
        @Html.LabelFor(model => model.CNE, "Código Naturaleza Escritura", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownListFor(model => model.CNE, new SelectList(
                new List<SelectListItem>
                {
                    new SelectListItem { Text = "Compraventa", Value = "1" },
                    new SelectListItem { Text = "Herencia", Value = "2" },
                    new SelectListItem { Text = "Otro", Value = "3" },
                    new SelectListItem { Text = "Resciliación", Value = "4" },
                    new SelectListItem { Text = "Transferencia de dominio", Value = "5" },
                    new SelectListItem { Text = "Bienes Nacionales", Value = "6" }
                }, "Value", "Text"), "Seleccione Código Naturalez Escritura", new { @class = "form-control", @required = "required", id = "Comunas-Dropdown" })
            @Html.ValidationMessageFor(model => model.CNE, "", new { @class = "text-danger" })
        </div>
    </div>

    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div class="form-group">
        @Html.LabelFor(model => model.Comuna, "Comuna", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.DropDownListFor(model => model.Comuna, new SelectList(ViewBag.comunas), "Seleccione una Comuna", new { @class = "form-control" })
            @Html.ValidationMessageFor(model => model.Comuna, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Manzana, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Manzana, new { htmlAttributes = new { @class = "form-control", placeholder = "Ingrese Manzana", @required = "required" } })
            @Html.ValidationMessageFor(model => model.Manzana, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.RolPredial, "Predio", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.RolPredial, new { htmlAttributes = new { @class = "form-control", placeholder = "Ingrese Predio", @required = "required" } })
            @Html.ValidationMessageFor(model => model.RolPredial, "", new { @class = "text-danger" })
        </div>
    </div>
    <div class="form-group" id="input-div-enajentes">
        @Html.LabelFor(model => model.Enajenantes, htmlAttributes: new { @class = "control-label col-md-2" })

        <div id="input-boxes-enajentes" class="col-md-10">

            <div class="input-group mb-3">
                <input type="text" class="form-control" name="inputEnajentes[]" placeholder="Ingrese Rut">
                <input type="text" class="form-control" name="inputEnajentes[]" placeholder="ingrese % Derechos">
            </div>

            <div class="form-check">
                <input type="checkbox" class="form-check-input" name="inputEnajentes[]" value="YES">
                <label class="form-check-label" for="flexCheckDefault">
                    % Derechos No Acreditados
                </label>
            </div>

        </div>

        <div class="col-md-offset-2 col-md-10">
            <button type="button" id="add-box-enajentes" class="btn btn-primary">Add Box</button>
            <button type="button" id="remove-box-enajentes" class="btn btn-danger">Remove Box</button>
        </div>


    </div>
    


    <div class="form-group">
        @Html.LabelFor(model => model.Adquirientes, htmlAttributes: new { @class = "control-label col-md-2" })

        <div id="input-boxes-adquirientes" class="col-md-10">

            <div class="input-group mb-3">
                <input type="text" class="form-control" name="inputAdquirientes[]" placeholder="Ingrese Rut">
                <input type="text" class="form-control" name="inputAdquirientes[]" placeholder="ingrese % Derechos">

            </div>

            <div class="form-check">
                <input type="checkbox" class="form-check-input" name="inputAdquirientes[]" value="YES">
                <label class="form-check-label" for="flexCheckDefault">
                    % Derechos No Acreditados
                </label>
            </div>

        </div>

        <div class="col-md-offset-2 col-md-10">
            <button type="button" id="add-box-adquirientes" class="btn btn-primary">Add Box</button>
            <button type="button" id="remove-box-adquirientes" class="btn btn-danger">Remove Box</button>
            @Html.ValidationMessageFor(model => model.Adquirientes, "", new { @class = "text-danger" })
        </div>


    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Foja, htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.Foja, new { htmlAttributes = new { @class = "form-control", placeholder = "Ingrese Foja", @required = "required" } })
            @Html.ValidationMessageFor(model => model.Foja, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.FechaInscripcion, "Fecha de Inscripcion", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.FechaInscripcion, new { htmlAttributes = new { @class = "form-control", placeholder = "Ingrese Fecha de Inscripcion", @required = "required" } })
            @Html.ValidationMessageFor(model => model.FechaInscripcion, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.NumeroInscripcion, "Numero de Inscripcion", htmlAttributes: new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.EditorFor(model => model.NumeroInscripcion, new { htmlAttributes = new { @class = "form-control", placeholder = "Ingrese Numero Inscripcion", @required = "required" } })
            @Html.ValidationMessageFor(model => model.NumeroInscripcion, "", new { @class = "text-danger" })
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input id="submit-data" type="submit" value="Create" class="btn btn-default" onchange="submitData()" />
        </div>
    </div>
</div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

<script>

        const inputBoxesEnajentes = document.getElementById("input-boxes-enajentes");
        const addButtonEnajentes = document.getElementById("add-box-enajentes");
        const removeButtonEnajentes = document.getElementById("remove-box-enajentes");

        const inputBoxesAdquirientes = document.getElementById("input-boxes-adquirientes");
        const addButtonAdquirientes = document.getElementById("add-box-adquirientes");
        const removeButtonAdquirientes = document.getElementById("remove-box-adquirientes");


        // Add event listeners
        addButtonEnajentes.addEventListener("click", addInputBoxEnajente);
        removeButtonEnajentes.addEventListener("click", removeInputBoxEnajente);

        addButtonAdquirientes.addEventListener("click", addInputBoxAdquirientes);
        removeButtonAdquirientes.addEventListener("click", removeInputBoxAdquirientes);

        
        const performDropdownAction = function () {
            console.log("xd");
            let current = this.value || document.getElementById('Comunas-Dropdown').value;
            const EnajenatesDIV = document.getElementById('input-div-enajentes');

            if (current == 1) {
                EnajenatesDIV.removeAttribute("hidden");
            }
            else if (current == 2) {
                EnajenatesDIV.setAttribute("hidden", "hidden");
            }
        }

        document.getElementById('Comunas-Dropdown').addEventListener('change', performDropdownAction);

        // Function to add an input box
        function addInputBoxEnajente() {
            const newInputBoxRut = document.createElement("input");
            newInputBoxRut.type = "text";
            newInputBoxRut.name = "inputEnajentes[]";
            newInputBoxRut.placeholder = "Ingrese Rut";
            newInputBoxRut.classList.add("form-control");
            newInputBoxRut.required = "required";
            inputBoxesEnajentes.appendChild(newInputBoxRut);

            const newInputBoxPorcentaje = document.createElement("input");
            newInputBoxPorcentaje.type = "text";
            newInputBoxPorcentaje.name = "inputEnajentes[]";
            newInputBoxPorcentaje.placeholder = "ingrese % Derechos";
            newInputBoxPorcentaje.classList.add("form-control");
            newInputBoxPorcentaje.required = "required";
            inputBoxesEnajentes.appendChild(newInputBoxPorcentaje);

            const newInputBoxCheck = document.createElement("input");
            newInputBoxCheck.type = "checkbox";
            newInputBoxCheck.name = "inputEnajentes[]";
            newInputBoxCheck.value = "YES";
            
            
            newInputBoxCheck.classList.add("form-check");
            inputBoxesEnajentes.appendChild(newInputBoxCheck);

            const newInputBoxCheckLabel = document.createElement("label");
            newInputBoxCheckLabel.textContent = "% Derechos No Acreditados";
            newInputBoxCheckLabel.classList.add("form-check-label");
            inputBoxesEnajentes.appendChild(newInputBoxCheckLabel);



        }

        // La accion se repite 4 veces para elimar las casillas Rut, Porcentaje y Check junto a su Label
        function removeInputBoxEnajente() {
            const lastInputBoxRut = inputBoxesEnajentes.lastElementChild;
            if (lastInputBoxRut !== null) {
                inputBoxesEnajentes.removeChild(lastInputBoxRut);
            }

            const lastInputBoxPorcentaje = inputBoxesEnajentes.lastElementChild;
            if (lastInputBoxPorcentaje !== null) {
                inputBoxesEnajentes.removeChild(lastInputBoxPorcentaje);
            }

            const lastInputBoxCheck = inputBoxesEnajentes.lastElementChild;
            if (lastInputBoxCheck !== null) {
                inputBoxesEnajentes.removeChild(lastInputBoxCheck);
            }

            const lastInputBoxLabel = inputBoxesEnajentes.lastElementChild;
            if (lastInputBoxLabel !== null) {
                inputBoxesEnajentes.removeChild(lastInputBoxLabel);
            }
        }
        //Funciones addInputBox crean nuevas casillas para añadir nuevo enajenante o adquiriente
        function addInputBoxAdquirientes() {
            const newInputBoxRut = document.createElement("input");
            newInputBoxRut.type = "text";
            newInputBoxRut.name = "inputAdquirientes[]";
            newInputBoxRut.placeholder = "Ingrese Rut";
            newInputBoxRut.classList.add("form-control");
            newInputBoxRut.required = "required";
            inputBoxesAdquirientes.appendChild(newInputBoxRut);

            const newInputBoxPorcentaje = document.createElement("input");
            newInputBoxPorcentaje.type = "text";
            newInputBoxPorcentaje.name = "inputAdquirientes[]";
            newInputBoxPorcentaje.placeholder = "ingrese % Derechos";
            newInputBoxPorcentaje.classList.add("form-control");
            newInputBoxPorcentaje.required = "required";
            inputBoxesAdquirientes.appendChild(newInputBoxPorcentaje);

            const newInputBoxCheck = document.createElement("input");
            newInputBoxCheck.type = "checkbox";
            newInputBoxCheck.name = "inputAdquirientes[]";
            newInputBoxCheck.value = "YES";
            
            newInputBoxCheck.classList.add("form-check");
            
            inputBoxesAdquirientes.appendChild(newInputBoxCheck);

            const newInputBoxCheckLabel = document.createElement("label");
            newInputBoxCheckLabel.textContent = "% Derechos No Acreditados";
            newInputBoxCheckLabel.classList.add("form-check-label");
            inputBoxesAdquirientes.appendChild(newInputBoxCheckLabel);

        }

        function removeInputBoxAdquirientes() {
            const lastInputBoxRut = inputBoxesAdquirientes.lastElementChild;
            if (lastInputBoxRut !== null) {
                inputBoxesAdquirientes.removeChild(lastInputBoxRut);
            }

            const lastInputBoxPorcentaje = inputBoxesAdquirientes.lastElementChild;
            if (lastInputBoxPorcentaje !== null) {
                inputBoxesAdquirientes.removeChild(lastInputBoxPorcentaje);
            }

            const lastInputBoxCheck = inputBoxesAdquirientes.lastElementChild;
            if (lastInputBoxCheck !== null) {
                inputBoxesAdquirientes.removeChild(lastInputBoxCheck);
            }

            const lastInputBoxLabel = inputBoxesAdquirientes.lastElementChild;
            if (lastInputBoxLabel !== null) {
                inputBoxesAdquirientes.removeChild(lastInputBoxLabel);
            }
        }


</script>
}
